<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Concise Response System Test - Oman Airports Chatbot</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.2em;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }
        
        .test-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .query-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .query-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-align: left;
        }
        
        .query-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .query-button:active {
            transform: translateY(0);
        }
        
        .response-area {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            min-height: 100px;
            white-space: pre-wrap;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
        }
        
        .loading {
            color: #667eea;
            font-style: italic;
        }
        
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .success {
            color: #27ae60;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .metric-label {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .clear-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .clear-btn:hover {
            background: #c0392b;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background-color: #27ae60; }
        .status-warning { background-color: #f39c12; }
        .status-error { background-color: #e74c3c; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Universal Concise Response System Test</h1>
        <p class="subtitle">Testing all query types for concise, helpful responses</p>
        
        <!-- Transportation Queries -->
        <div class="test-section">
            <h3>üöó Transportation Queries</h3>
            <div class="query-grid">
                <button class="query-button" onclick="testQuery('Is car rental available at Muscat Airport?')">Car Rental Availability</button>
                <button class="query-button" onclick="testQuery('How much is parking for 2 hours?')">Parking Rates</button>
                <button class="query-button" onclick="testQuery('Are there taxis at the airport?')">Taxi Services</button>
                <button class="query-button" onclick="testQuery('Is there a shuttle bus?')">Shuttle Services</button>
            </div>
        </div>

        <!-- Airport Services Queries -->
        <div class="test-section">
            <h3>üè¢ Airport Services Queries</h3>
            <div class="query-grid">
                <button class="query-button" onclick="testQuery('What restaurants are available?')">Dining Options</button>
                <button class="query-button" onclick="testQuery('Is there duty free shopping?')">Shopping</button>
                <button class="query-button" onclick="testQuery('Is there free WiFi?')">WiFi/Connectivity</button>
                <button class="query-button" onclick="testQuery('Are there airport lounges?')">Lounges</button>
            </div>
        </div>

        <!-- Facilities Queries -->
        <div class="test-section">
            <h3>üè¢ Facilities Queries</h3>
            <div class="query-grid">
                <button class="query-button" onclick="testQuery('Where are the prayer rooms?')">Prayer Facilities</button>
                <button class="query-button" onclick="testQuery('Where are the restrooms?')">Restroom Facilities</button>
                <button class="query-button" onclick="testQuery('Is there a medical center?')">Medical Services</button>
                <button class="query-button" onclick="testQuery('My baggage is lost')">Baggage Services</button>
            </div>
        </div>

        <!-- General Information Queries -->
        <div class="test-section">
            <h3>‚ÑπÔ∏è General Information Queries</h3>
            <div class="query-grid">
                <button class="query-button" onclick="testQuery('What services are available at the airport?')">General Services</button>
                <button class="query-button" onclick="testQuery('Tell me about Muscat Airport')">Airport Information</button>
                <button class="query-button" onclick="testQuery('What facilities do you have?')">Facilities Overview</button>
                <button class="query-button" onclick="testQuery('How can I contact the airport?')">Contact Information</button>
            </div>
        </div>

        <!-- Greeting & Conversation Queries -->
        <div class="test-section">
            <h3>üëã Greeting & Conversation</h3>
            <div class="query-grid">
                <button class="query-button" onclick="testQuery('Hello')">Greeting</button>
                <button class="query-button" onclick="testQuery('Hi there')">Casual Greeting</button>
                <button class="query-button" onclick="testQuery('Good morning')">Time-based Greeting</button>
                <button class="query-button" onclick="testQuery('Can you help me?')">Help Request</button>
            </div>
        </div>

        <button class="clear-btn" onclick="clearResponse()">Clear Response</button>
        
        <div class="response-area" id="responseArea">
            Click any query button above to test the universal concise response system...
        </div>
        
        <div class="metrics">
            <div class="metric">
                <div class="metric-value" id="responseLength">0</div>
                <div class="metric-label">Characters</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="responseTime">0ms</div>
                <div class="metric-label">Response Time</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="queryCount">0</div>
                <div class="metric-label">Queries Tested</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="successRate">0%</div>
                <div class="metric-label">Success Rate</div>
            </div>
        </div>
    </div>

    <script>
        let queryCount = 0;
        let successCount = 0;

        async function testQuery(query) {
            const responseArea = document.getElementById('responseArea');
            const startTime = Date.now();
            
            queryCount++;
            updateMetrics();
            
            responseArea.innerHTML = `üîÑ Testing query: "${query}"\n\nProcessing...`;
            responseArea.className = 'response-area loading';
            
            try {
                // Create session first
                const sessionResponse = await fetch('/api/chat/session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                });
                
                if (!sessionResponse.ok) {
                    throw new Error(`Session creation failed: ${sessionResponse.status}`);
                }
                
                const sessionData = await sessionResponse.json();
                const sessionId = sessionData.sessionId;
                
                // Send the query
                const response = await fetch('/api/chat/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: query,
                        sessionId: sessionId
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                // Display results
                const responseLength = data.response.length;
                const isSuccess = responseLength > 0 && responseLength < 1000; // Consider concise responses as success
                
                if (isSuccess) {
                    successCount++;
                    responseArea.className = 'response-area success';
                } else {
                    responseArea.className = 'response-area';
                }
                
                responseArea.innerHTML = `‚úÖ Query: "${query}"
üìä Response Length: ${responseLength} characters
‚è±Ô∏è Response Time: ${responseTime}ms
üéØ Concise: ${isSuccess ? 'YES' : 'NO'}

üìù Response:
${data.response}

üîç Intent: ${data.intent || 'Not detected'}
üéØ Confidence: ${data.confidence || 'Not provided'}`;
                
                // Update metrics
                document.getElementById('responseLength').textContent = responseLength;
                document.getElementById('responseTime').textContent = responseTime + 'ms';
                updateMetrics();
                
            } catch (error) {
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                responseArea.className = 'response-area error';
                responseArea.innerHTML = `‚ùå Query: "${query}"
‚è±Ô∏è Response Time: ${responseTime}ms

üö® Error: ${error.message}

This indicates an issue with the API or network connection.`;
                
                document.getElementById('responseTime').textContent = responseTime + 'ms';
                updateMetrics();
            }
        }
        
        function updateMetrics() {
            document.getElementById('queryCount').textContent = queryCount;
            const successRate = queryCount > 0 ? Math.round((successCount / queryCount) * 100) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
        }
        
        function clearResponse() {
            document.getElementById('responseArea').innerHTML = 'Click any query button above to test the universal concise response system...';
            document.getElementById('responseArea').className = 'response-area';
        }
    </script>
</body>
</html> 